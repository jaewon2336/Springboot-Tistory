{{>/layout/main-header}}

<div class="container">
    <div class="my_auth_box">
        <div class="my_auth_form_box">
            <div class="d-flex justify-content-center">
                <img id="profile-img-btn" src="https://i1.sndcdn.com/avatars-000373392764-zp0p80-t500x500.jpg"
                    class="my_profile_rounded_img_btn_lg">
                <form id="profile-img-form">
                    <input id="profile-img-input" type="file" class="my_hidden" />
                </form>
            </div>
            <div class="my_error_box my_hidden">

            </div>
            <!-- 수정은 put 요청 fetch 사용해야함 -->
            <form>
                <input id="user-id" type="hidden" value="{{principal.id}}">
                <input id="username" class="my_auth_form_box_input" type="text" placeholder="{{principal.username}}"
                    maxlength="20" required readonly />
                <input id="password" class="my_auth_form_box_input" type="password" placeholder="기존 비밀번호" maxlength="20"
                    required />
                <input id="same-password" class="my_auth_form_box_input" type="password" placeholder="수정 비밀번호"
                    maxlength="20" required />
                <input class="my_auth_form_box_input" type="email" name="email" placeholder="이메일" maxlength="60"
                    required readonly />
                <button id="btn-update" type="submit" class="my_secondary_btn">회원정보수정</button>
            </form>
            <div class="my_auth_form_box_link">
                <div><a href="/login-form">로그인</a></div>
                <div><a href="/user/password-reset-form">비밀번호 찾기</a></div>
            </div>
        </div>
    </div>
    <br />
</div>

<script>

    let userId = $("#user-id").val();

    $("#profile-img-btn").click(() => {
        // 파일 업로드 실행
        $("#profile-img-input").click(); // 파일 선택창 오픈
    });

    $("#profile-img-input").change((event) => { // 변화가 생기면(=파일을 선택하면)

        let file = event.target.files[0];

        if (!file.type.match("image.*")) {
            alert("이미지를 선택해주세요.");
            return;
        }

        let fileForm = $("#profile-img-form")[0];
        let formData = new FormData(fileForm);

        // fetch()

        let reader = new FileReader();

        // 아직 실행안됨 : 콜 백 함수
        reader.onload = (event) => {
            $("#profile-img-btn").attr("src", event.target.result);
            $("#header-profile-img").attr("src", event.target.result);
        }

        reader.readAsDataURL(file);
    });
</script>

{{>/layout/footer}}